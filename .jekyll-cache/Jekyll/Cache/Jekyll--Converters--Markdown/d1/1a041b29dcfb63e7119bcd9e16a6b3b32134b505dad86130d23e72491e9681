I"ó1<h1 id="dockerå…¥é—¨æ•™ç¨‹äºŒå‘½ä»¤">Dockerå…¥é—¨æ•™ç¨‹ï¼ˆäºŒï¼‰å‘½ä»¤</h1>

<p>ã€ç¼–è€…çš„è¯ã€‘DockerOneç»„ç»‡ç¿»è¯‘äº†Flux7çš„Dockerå…¥é—¨æ•™ç¨‹ï¼Œæœ¬æ–‡æ˜¯ç³»åˆ—å…¥é—¨æ•™ç¨‹çš„ç¬¬äºŒç¯‡ï¼Œä»‹ç»äº†Dockerçš„åŸºæœ¬å‘½ä»¤ä»¥åŠå‘½ä»¤çš„ç”¨æ³•å’ŒåŠŸèƒ½ã€‚</p>

<p>åœ¨<a href="http://dockerone.com/article/101">Dockerç³»åˆ—æ•™ç¨‹çš„ç¬¬ä¸€ç¯‡æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†Dockerçš„åŸºç¡€çŸ¥è¯†ï¼ŒçŸ¥é“äº†å®ƒæ˜¯å¦‚ä½•å·¥ä½œä»¥åŠå¦‚ä½•å®‰è£…çš„ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ 15ä¸ªDockerå‘½ä»¤ï¼Œå¹¶é€šè¿‡å®è·µæ¥å­¦ä¹ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>

<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æ£€æŸ¥Dockerçš„å®‰è£…æ˜¯å¦æ­£ç¡®ï¼š</p>

<pre class="prettyprint">
docker info   
</pre>

<p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™æ¡å‘½ä»¤ï¼Œåˆ™è¡¨ç¤ºDockerå®‰è£…é”™è¯¯ã€‚å¦‚æœå®‰è£…æ­£ç¡®ï¼Œåˆ™ä¼šè¾“å‡ºç±»ä¼¼ä¸‹é¢çš„å†…å®¹ï¼š</p>

<p><a href="http://dockone.io/uploads/article/20141229/68dab0635310f3b5405cb950b5cbb96b.png"><img src="http://dockone.io/uploads/article/20141229/68dab0635310f3b5405cb950b5cbb96b.png" alt="docker-info.png" title="docker-info.png" /></a></p>

<p>åˆ°è¿™ä¸€æ­¥Dockeré‡Œè¿˜æ²¡æœ‰é•œåƒæˆ–æ˜¯å®¹å™¨ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨å‘½ä»¤é¢„å…ˆæ„å»ºçš„é•œåƒæ¥åˆ›å»ºæ¥ä¸€ä¸ªï¼š</p>

<pre class="prettyprint">
sudo docker pull busybox  
</pre>

<p><a href="http://dockone.io/uploads/article/20141229/ebd90889c2d6e424753a10925ad83acc.png"><img src="http://dockone.io/uploads/article/20141229/ebd90889c2d6e424753a10925ad83acc.png" alt="docker-pull-busybox.png" title="docker-pull-busybox.png" /></a></p>

<p>BusyBoxæ˜¯ä¸€ä¸ªæœ€å°çš„Linuxç³»ç»Ÿï¼Œå®ƒæä¾›äº†è¯¥ç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½ï¼Œä¸åŒ…å«ä¸€äº›ä¸GNUç›¸å…³çš„åŠŸèƒ½å’Œé€‰é¡¹ã€‚</p>

<p>ä¸‹ä¸€æ­¥æˆ‘ä»¬å°†è¿è¡Œä¸€ä¸ªâ€œHello Worldâ€çš„ä¾‹å­ï¼Œæˆ‘ä»¬æš‚ä¸”å«å®ƒâ€œHello Dockerâ€å§ã€‚</p>

<pre class="prettyprint">
docker run busybox /bin/echo Hello Docker  
</pre>

<p><a href="http://dockone.io/uploads/article/20141229/327aae80228f58acad3d35167289be17.png"><img src="http://dockone.io/uploads/article/20141229/327aae80228f58acad3d35167289be17.png" alt="hello-docker.png" title="hello-docker.png" /></a></p>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä»¥åå°è¿›ç¨‹çš„æ–¹å¼è¿è¡Œ<code class="highlighter-rouge">hello docker</code>ï¼š</p>

<pre class="prettyprint">
sample_job=$(docker run -d busybox /bin/sh -c "while true; do echo Docker; sleep 1; done")  
</pre>

<p><a href="http://dockone.io/uploads/article/20141229/fbda65537920ab24b9f7a198c71d2011.png"><img src="http://dockone.io/uploads/article/20141229/fbda65537920ab24b9f7a198c71d2011.png" alt="docker-job.png" title="docker-job.png" /></a><br />
<code class="highlighter-rouge">sample_job</code>å‘½ä»¤ä¼šéš”ä¸€ç§’æ‰“å°ä¸€æ¬¡Dockerï¼Œä½¿ç”¨<code class="highlighter-rouge">docker logs</code>å¯ä»¥æŸ¥çœ‹è¾“å‡ºçš„ç»“æœã€‚å¦‚æœæ²¡æœ‰ç»™è¿™ä¸ªjobèµ·åå­—ï¼Œé‚£è¿™ä¸ªjobå°±ä¼šè¢«åˆ†é…ä¸€ä¸ªidï¼Œä»¥åä½¿ç”¨å‘½ä»¤ä¾‹å¦‚<code class="highlighter-rouge">docker logs</code>æŸ¥çœ‹æ—¥å¿—å°±ä¼šå˜å¾—æ¯”è¾ƒéº»çƒ¦ã€‚</p>

<p>è¿è¡Œ<code class="highlighter-rouge">docker logs</code>å‘½ä»¤æ¥æŸ¥çœ‹jobçš„å½“å‰çŠ¶æ€ï¼š</p>

<pre class="prettyprint">
docker logs $sample_job  
</pre>

<p>æ‰€æœ‰Dockerå‘½ä»¤å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</p>

<pre class="prettyprint">
docker help  
</pre>

<p>åä¸º<code class="highlighter-rouge">sample_job</code>çš„å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åœæ­¢ï¼š</p>

<pre class="prettyprint">
docker stop $sample_job  
</pre>

<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥é‡æ–°å¯åŠ¨è¯¥å®¹å™¨ï¼š</p>

<pre class="prettyprint">
docker restart $sample_job  
</pre>

<p>å¦‚æœè¦å®Œå…¨ç§»é™¤å®¹å™¨ï¼Œéœ€è¦å…ˆå°†è¯¥å®¹å™¨åœæ­¢ï¼Œç„¶åæ‰èƒ½ç§»é™¤ã€‚åƒè¿™æ ·ï¼š</p>

<pre class="prettyprint">
docker stop $sample_job  

docker rm $sample_job  
</pre>

<p>å°†å®¹å™¨çš„çŠ¶æ€ä¿å­˜ä¸ºé•œåƒï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>

<pre class="prettyprint">
docker commit $sample_job job1  
</pre>

<p>æ³¨æ„ï¼Œé•œåƒåç§°åªèƒ½å–å­—ç¬¦[a-z]å’Œæ•°å­—[0-9]ã€‚</p>

<p>ç°åœ¨ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰é•œåƒçš„åˆ—è¡¨ï¼š</p>

<pre class="prettyprint">
docker images  
</pre>

<p>åœ¨<a href="http://dockerone.com/article/101">æˆ‘ä»¬ä¹‹å‰çš„Dockeræ•™ç¨‹</a>ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ è¿‡é•œåƒæ˜¯å­˜å‚¨åœ¨Docker registryã€‚åœ¨registryä¸­çš„é•œåƒå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾åˆ°ï¼š</p>

<pre class="prettyprint">
docker search (image-name)  
</pre>

<p>æŸ¥çœ‹é•œåƒçš„å†å²ç‰ˆæœ¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>

<pre class="prettyprint">
docker history (image_name)  
</pre>

<p>æœ€åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†é•œåƒæ¨é€åˆ°registryï¼š</p>

<pre class="prettyprint">
docker push (image_name)  
</pre>

<p>éå¸¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œä½ å¿…é¡»è¦çŸ¥é“å­˜å‚¨åº“ä¸æ˜¯æ ¹å­˜å‚¨åº“ï¼Œå®ƒåº”è¯¥ä½¿ç”¨æ­¤æ ¼å¼<code class="highlighter-rouge">(user)/(repo_name)</code>ã€‚</p>

<h1 id="ä¿®æ”¹dockeré»˜è®¤ç«¯å£å·">ä¿®æ”¹dockeré»˜è®¤ç«¯å£å·</h1>

<p><strong>CentOS 6</strong></p>

<p><strong>CentOS 7è®¾ç½®</strong></p>

<p><del>åœ¨RHEL7ä¸­ï¼Œæ‚¨è¿˜å¯ä»¥ <code class="highlighter-rouge">vim /etc/sysconfig/docker</code>æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¿®æ”¹docker.serviceå•å…ƒæ–‡ä»¶</del></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/sysconfig/docker</span>

<span class="c"># Modify these options if you want to change the way the docker daemon runs</span>
<span class="nv">OPTIONS</span><span class="o">=</span><span class="nt">--selinux-enabled</span> <span class="nt">-H</span> unix:///var/run/docker.sock <span class="nt">-H</span> tcp://0.0.0.0:4243
</code></pre></div></div>
<ol>
  <li>æ‰¾åˆ°systemdç›®å½•ä¸‹docker.serviceæ–‡ä»¶,é»˜è®¤ä½ç½®</li>
</ol>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/lib/systemd/system/docker.service
</code></pre></div></div>
<ol>
  <li>ç¼–è¾‘docker.serviceæ–‡ä»¶ï¼Œæ‰¾åˆ°[service]èŠ‚ç‚¹ï¼Œæ‰¾åˆ°ExecStartè¡Œ</li>
</ol>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Docker Application Container Engine
<span class="nv">Documentation</span><span class="o">=</span>http://docs.docker.com
<span class="nv">After</span><span class="o">=</span>network.target docker.socket
<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>notify
<span class="nv">EnvironmentFile</span><span class="o">=</span>-/run/flannel/docker
<span class="nv">WorkingDirectory</span><span class="o">=</span>/usr/local/bin
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/dockerd                 <span class="nt">-H</span> tcp://0.0.0.0:4243                 <span class="nt">-H</span> unix:///var/run/docker.sock                 <span class="nt">--selinux-enabled</span><span class="o">=</span><span class="nb">false</span>                 <span class="nt">--log-opt</span> max-size<span class="o">=</span>1g
<span class="nv">ExecReload</span><span class="o">=</span>/bin/kill <span class="nt">-s</span> HUP
<span class="c"># Having non-zero Limit*s causes performance problems due to accounting overhead</span>
<span class="c"># in the kernel. We recommend using cgroups to do container-local accounting.</span>
<span class="nv">LimitNOFILE</span><span class="o">=</span>infinity
<span class="nv">LimitNPROC</span><span class="o">=</span>infinity
<span class="nv">LimitCORE</span><span class="o">=</span>infinity
<span class="c"># Uncomment TasksMax if your systemd version supports it.</span>
<span class="c"># Only systemd 226 and above support this version.</span>
<span class="c">#TasksMax=infinity</span>
<span class="nv">TimeoutStartSec</span><span class="o">=</span>0
<span class="c"># set delegate yes so that systemd does not reset the cgroups of docker containers</span>
<span class="nv">Delegate</span><span class="o">=</span><span class="nb">yes</span>
<span class="c"># kill only the docker process, not all processes in the cgroup</span>
<span class="nv">KillMode</span><span class="o">=</span>process
<span class="nv">Restart</span><span class="o">=</span>on-failure
<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target

</code></pre></div></div>
<ol>
  <li>åˆ·æ–°é…ç½®æ–‡ä»¶
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl daemon-reload //åˆ·æ–°ä¸Šé¢çš„æ–‡ä»¶æ›´æ”¹
</code></pre></div>    </div>
  </li>
  <li>é‡å¯dockeræœåŠ¡
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl restart docker
</code></pre></div>    </div>
  </li>
  <li>éªŒè¯ç«¯å£æ˜¯å¦æ‰“å¼€
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat -l | grep 4243 //éªŒè¯ç«¯å£æ˜¯å¦æ‰“å¼€
</code></pre></div>    </div>
  </li>
  <li>ä»å®¹å™¨å¤–éƒ¨è¿æ¥docker</li>
</ol>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ä»æŸä¸ªåœ°æ–¹è¿æ¥åˆ°dockerä¸»æœºï¼Œæ¯”å¦‚Jenkins Docker Pluginï¼Œå³tcpï¼š// <span class="o">[</span>server_ip]ï¼š4243
</code></pre></div></div>

<p><strong>å¦‚æœè¦åœ¨å®¹å™¨å¤–éƒ¨è®¿é—®ï¼Œè¯·å¼€å¯é˜²ç«å¢™4243ç«¯å£</strong></p>

<p><strong>a. å¼€å¯ç«¯å£</strong>
firewall-cmd â€“zone=public â€“add-port=80/tcp â€“permanent
 å‘½ä»¤å«ä¹‰ï¼š
â€“zone #ä½œç”¨åŸŸ
â€“add-port=80/tcp #æ·»åŠ ç«¯å£ï¼Œæ ¼å¼ä¸ºï¼šç«¯å£/é€šè®¯åè®®
â€“permanent #æ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±æ•ˆ
<strong>b. é‡å¯é˜²ç«å¢™</strong>
firewall-cmd â€“reload</p>

<p><strong>CentOS 7.0é»˜è®¤ä½¿ç”¨çš„æ˜¯firewallä½œä¸ºé˜²ç«å¢™ï¼Œä½¿ç”¨iptableså¿…é¡»é‡æ–°è®¾ç½®ä¸€ä¸‹</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1ã€ç›´æ¥å…³é—­é˜²ç«å¢™</span>
systemctl stop firewalld.service           <span class="c">#åœæ­¢firewall</span>
systemctl disable firewalld.service     <span class="c">#ç¦æ­¢firewallå¼€æœºå¯åŠ¨</span>

<span class="c"># 2ã€è®¾ç½® iptables service</span>
yum <span class="nt">-y</span> <span class="nb">install </span>iptables-services

<span class="c"># å¦‚æœè¦ä¿®æ”¹é˜²ç«å¢™é…ç½®ï¼Œå¦‚å¢åŠ é˜²ç«å¢™ç«¯å£3306</span>
vi /etc/sysconfig/iptables 

<span class="c"># å¢åŠ è§„åˆ™</span>
<span class="nt">-A</span> INPUT <span class="nt">-m</span> state <span class="nt">--state</span> NEW <span class="nt">-m</span> tcp <span class="nt">-p</span> tcp <span class="nt">--dport</span> 3306 <span class="nt">-j</span> ACCEPT

<span class="c"># ä¿å­˜é€€å‡ºå</span>
systemctl restart iptables.service <span class="c">#é‡å¯é˜²ç«å¢™ä½¿é…ç½®ç”Ÿæ•ˆ</span>
systemctl <span class="nb">enable </span>iptables.service <span class="c">#è®¾ç½®é˜²ç«å¢™å¼€æœºå¯åŠ¨</span>

<span class="c"># æœ€åé‡å¯ç³»ç»Ÿä½¿è®¾ç½®ç”Ÿæ•ˆå³å¯ã€‚</span>
</code></pre></div></div>

<p>å‚è§:(https://stackoverflow.com/questions/26166550/set-docker-opts-in-centos/44834532#44834532)</p>

<p>è¿™éƒ½æ˜¯ä¸€äº›éå¸¸åŸºæœ¬çš„Dockerå‘½ä»¤ã€‚åœ¨æˆ‘ä»¬<a href="http://dockerone.com/article/106">Dockeræ•™ç¨‹ç³»åˆ—çš„ç¬¬å…­ç« </a>ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨Dockerè¿è¡ŒPythonçš„Webåº”ç”¨ç¨‹åºï¼Œä»¥åŠä¸€äº›è¿›é˜¶çš„Dockerå‘½ä»¤ã€‚</p>

<p><strong>åŸæ–‡é“¾æ¥ï¼š<a href="http://blog.flux7.com/blogs/docker/docker-tutorial-series-part-1-an-introduction"> Part 2: The 15 Commands</a>ï¼ˆç¿»è¯‘ï¼š<a href="https://github.com/llitfkitfk">ç”°æµ©æµ©</a> å®¡æ ¡ï¼šæé¢–æ°ï¼‰</strong></p>

<p>ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼<br />
<strong>è¯‘è€…ä»‹ç»</strong><br />
<strong>ç”°æµ©æµ©</strong>ï¼Œ<a href="http://sydney.edu.au/engineering/it/">æ‚‰å°¼å¤§å­¦USYD</a>ç¡•å£«ç ”ç©¶ç”Ÿï¼Œç›®å‰åœ¨ç æµ·ä»äº‹Androidåº”ç”¨å¼€å‘å·¥ä½œã€‚ä¸šä½™æ—¶é—´ä¸“æ³¨Dockerçš„å­¦ä¹ ä¸ç ”ç©¶ï¼Œå¸Œæœ›é€šè¿‡<a href="http://dockerone.com/">DockerOne</a>æŠŠæœ€æ–°æœ€ä¼˜ç§€çš„è¯‘æ–‡è´¡çŒ®ç»™å¤§å®¶ï¼Œä¸è¯»è€…ä¸€èµ·ç•…æ¸¸Dockerçš„æµ·æ´‹ã€‚</p>

<hr />
<p><a href="http://dockerone.com/article/101">Dockerå…¥é—¨æ•™ç¨‹ï¼ˆä¸€ï¼‰ä»‹ç»</a><br />
<a href="http://dockerone.com/article/102">Dockerå…¥é—¨æ•™ç¨‹ï¼ˆäºŒï¼‰å‘½ä»¤</a><br />
<a href="http://dockerone.com/article/103">Dockerå…¥é—¨æ•™ç¨‹ï¼ˆä¸‰ï¼‰DockerFile</a><br />
<a href="http://dockerone.com/article/104">Dockerå…¥é—¨æ•™ç¨‹ï¼ˆå››ï¼‰Docker Registry</a><br />
<a href="http://dockerone.com/article/105">Dockerå…¥é—¨æ•™ç¨‹ï¼ˆäº”ï¼‰Dockerå®‰å…¨</a><br />
<a href="http://dockerone.com/article/106">Dockerå…¥é—¨æ•™ç¨‹ï¼ˆå…­ï¼‰å¦å¤–çš„15ä¸ªDockerå‘½ä»¤</a><br />
<a href="http://dockerone.com/article/107">Dockerå…¥é—¨æ•™ç¨‹ï¼ˆä¸ƒï¼‰Docker API</a><br />
<a href="http://dockerone.com/article/109">Dockerå…¥é—¨æ•™ç¨‹ï¼ˆå…«ï¼‰Docker Remote API</a><br />
<a href="http://dockerone.com/article/110">Dockerå…¥é—¨æ•™ç¨‹ï¼ˆä¹ï¼‰10ä¸ªé•œåƒç›¸å…³çš„API</a></p>
:ET