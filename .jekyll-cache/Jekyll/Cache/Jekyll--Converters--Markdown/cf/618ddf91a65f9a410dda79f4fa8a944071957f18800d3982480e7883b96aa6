I"è<h1 id="å¦‚ä½•ç”¨nagiosè¿œç¨‹æ‰§è¡Œæ’ä»¶nrpeæ¥æ£€æµ‹æœåŠ¡å™¨å†…å­˜ä½¿ç”¨ç‡">å¦‚ä½•ç”¨Nagiosè¿œç¨‹æ‰§è¡Œæ’ä»¶ï¼ˆNRPEï¼‰æ¥æ£€æµ‹æœåŠ¡å™¨å†…å­˜ä½¿ç”¨ç‡</h1>

<p>åœ¨<a href="http://linux.cn/article-4101-1.html">å…ˆå‰çš„æ•™ç¨‹ä¸­</a>ï¼Œæˆ‘ä»¬å·²ç»è§åˆ°äº†å¦‚ä½•åœ¨Nagiosè®¾ç½®ä¸­è®¾ç½®Nagiosè¿œç¨‹æ‰§è¡Œæ’ä»¶ï¼ˆNRPEï¼‰ã€‚ç„¶è€Œï¼Œç›‘æ§å†…å­˜ä½¿ç”¨ç‡çš„è„šæœ¬å’Œæ’ä»¶å¹¶æ²¡æœ‰åœ¨åŸç”Ÿçš„Nagiosä¸­ã€‚æœ¬ç¯‡ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä½•é…ç½®NRPEæ¥ç›‘æ§è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å†…å­˜ä½¿ç”¨ç‡ã€‚</p>

<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201410/27/225219vev9r9l70rdqtg0o.jpg" alt="" /></p>

<p>æˆ‘ä»¬è¦ç”¨çš„ç›‘æ§å†…å­˜çš„è„šæœ¬åœ¨<a href="http://exchange.nagios.org/directory/Plugins/Operating-Systems/Solaris/check_mem-2Epl/details">Nagios å¸‚åœº</a>ä¸Šï¼Œåœ¨åˆ›å»ºè€…çš„<a href="https://github.com/justintime/nagios-plugins/blob/master/check_mem/check_mem.pl">Githubä»“åº“</a>ä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°ã€‚</p>

<p>å‡è®¾æˆ‘ä»¬å·²ç»å®‰è£…äº†NRPEï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨æˆ‘ä»¬æƒ³è¦ç›‘æ§çš„æœåŠ¡å™¨ä¸Šä¸‹è½½è„šæœ¬ã€‚</p>

<h3 id="å‡†å¤‡è¿œç¨‹æœåŠ¡å™¨">å‡†å¤‡è¿œç¨‹æœåŠ¡å™¨</h3>

<h4 id="åœ¨-debainubuntu-ä¸­">åœ¨ Debain/Ubuntu ä¸­:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# cd /usr/lib/nagios/plugins/
2.  \# wget https://raw.githubusercontent.com/justintime/nagios-plugins/master/check_mem/check_mem.pl
3.  \# mv check_mem.pl check_mem
4.  \# chmod +x check_mem 
</pre>

<h4 id="åœ¨-rhelcentos-ä¸­">åœ¨ RHEL/CentOS ä¸­:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# cd /usr/lib64/nagios/plugins/ (or /usr/lib/nagios/plugins/ for 32-bit)
2.  \# wget https://raw.githubusercontent.com/justintime/nagios-plugins/master/check_mem/check_mem.pl
3.  \# mv check_mem.pl check_mem
4.  \# chmod +x check_mem
</pre>

<p>ä½ å¯ä»¥é€šè¿‡æ‰‹å·¥åœ¨æœ¬åœ°è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ£€æŸ¥è„šæœ¬çš„è¾“å‡ºæ˜¯å¦æ­£å¸¸ã€‚å½“ä½¿ç”¨NRPEæ—¶ï¼Œè¿™æ¡å‘½ä»¤åº”è¯¥ä¼šæ£€æµ‹ç©ºé—²çš„å†…å­˜ï¼Œå½“å¯ç”¨å†…å­˜å°äº20%æ—¶ä¼šå‘å‡ºè­¦å‘Šï¼Œå¹¶ä¸”åœ¨å¯ç”¨å†…å­˜å°äº10%æ—¶ä¼šç”Ÿæˆä¸€ä¸ªä¸¥é‡è­¦å‘Šã€‚</p>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# ./check_mem -f -w 20 -c 10 
</pre>

<hr />

<pre class="prettyprint linenums prettyprinted" style="">
1.  OK - 34.0% (2735744 kB) free.|TOTAL=8035340KB;;;; USED=5299596KB;6428272;7231806;; FREE=2735744KB;;;; CACHES=2703504KB;;;;
</pre>

<p>å¦‚æœä½ çœ‹åˆ°åƒä¸Šé¢é‚£æ ·çš„è¾“å‡ºï¼Œé‚£å°±æ„å‘³è¿™å‘½ä»¤æ­£å¸¸å·¥ä½œç€ã€‚</p>

<p>ç°åœ¨è„šæœ¬å·²ç»å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬è¦å®šä¹‰NRPEæ£€æŸ¥å†…å­˜ä½¿ç”¨ç‡çš„å‘½ä»¤äº†ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œå‘½ä»¤ä¼šæ£€æŸ¥å¯ç”¨å†…å­˜ï¼Œåœ¨å¯ç”¨ç‡å°äº20%æ—¶å‘å‡ºè­¦æŠ¥ï¼Œå°äº10%æ—¶å‘å‡ºä¸¥é‡è­¦å‘Šã€‚</p>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# vim /etc/nagios/nrpe.cfg 
</pre>

<h4 id="å¯¹äº-debianubuntu">å¯¹äº Debian/Ubuntu:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  command[check_mem]=/usr/lib/nagios/plugins/check_mem  -f -w 20 -c 10
</pre>

<h4 id="å¯¹äº-rhelcentos-32-bit">å¯¹äº RHEL/CentOS 32 bit:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  command[check_mem]=/usr/lib/nagios/plugins/check_mem  -f -w 20 -c 10
</pre>

<h4 id="å¯¹äº-rhelcentos-64-bit">å¯¹äº RHEL/CentOS 64 bit:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  command[check_mem]=/usr/lib64/nagios/plugins/check_mem  -f -w 20 -c 10
</pre>

<h3 id="å‡†å¤‡-nagios-æœåŠ¡å™¨">å‡†å¤‡ Nagios æœåŠ¡å™¨</h3>

<p>åœ¨NagiosæœåŠ¡å™¨ä¸­ï¼Œæˆ‘ä»¬ä¸ºNRPEå®šä¹‰äº†ä¸€æ¡è‡ªå®šä¹‰å‘½ä»¤ã€‚è¯¥å‘½ä»¤å¯å­˜å‚¨åœ¨Nagioså†…çš„ä»»ä½•ç›®å½•ä¸­ã€‚ä¸ºäº†è®©æœ¬æ•™ç¨‹ç®€å•ï¼Œæˆ‘ä»¬ä¼šå°†å‘½ä»¤å®šä¹‰æ”¾åœ¨/etc/nagiosç›®å½•ä¸­ã€‚</p>

<h4 id="å¯¹äº-debianubuntu-1">å¯¹äº Debian/Ubuntu:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# vim /etc/nagios3/conf.d/nrpe_command.cfg 
</pre>

<hr />

<pre class="prettyprint linenums prettyprinted" style="">
1.  define command{
2.          command_name check_nrpe
3.          command_line /usr/lib/nagios/plugins/check_nrpe -H '$HOSTADDRESS$'  -c '$ARG1$'
4.  }
</pre>

<h4 id="å¯¹äº-rhelcentos-32-bit-1">å¯¹äº RHEL/CentOS 32 bit:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# vim /etc/nagios/objects/nrpe_command.cfg 
</pre>

<hr />

<pre class="prettyprint linenums prettyprinted" style="">
1.  define command{
2.          command_name check_nrpe
3.          command_line /usr/lib/nagios/plugins/check_nrpe -H $HOSTADDRESS$ -c $ARG1$
4.          }
</pre>

<h4 id="å¯¹äº-rhelcentos-64-bit-1">å¯¹äº RHEL/CentOS 64 bit:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# vim /etc/nagios/objects/nrpe_command.cfg 
</pre>

<hr />

<pre class="prettyprint linenums prettyprinted" style="">
1.  define command{
2.          command_name check_nrpe
3.          command_line /usr/lib64/nagios/plugins/check_nrpe -H $HOSTADDRESS$ -c $ARG1$
4.          }
</pre>

<p>ç°åœ¨æˆ‘ä»¬å®šä¹‰Nagiosçš„æœåŠ¡æ£€æŸ¥</p>

<h4 id="åœ¨-debianubuntu-ä¸Š">åœ¨ Debian/Ubuntu ä¸Š:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# vim /etc/nagios3/conf.d/nrpe_service_check.cfg 
</pre>

<hr />

<pre class="prettyprint linenums prettyprinted" style="">
1.  define service{
2.          use                            local-service
3.          host_name                      remote-server
4.          service_description            Check RAM
5.          check_command                  check_nrpe!check_mem
6.  }
</pre>

<h4 id="åœ¨-rhelcentos-ä¸Š">åœ¨ RHEL/CentOS ä¸Š:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# vim /etc/nagios/objects/nrpe_service_check.cfg 
</pre>

<hr />

<pre class="prettyprint linenums prettyprinted" style="">
1.  define service{
2.          use                            local-service
3.          host_name                      remote-server
4.          service_description            Check RAM
5.          check_command                  check_nrpe!check_mem
6.  }
</pre>

<p>æœ€åæˆ‘ä»¬é‡å¯NagiosæœåŠ¡</p>

<h4 id="åœ¨-debianubuntu-ä¸Š-1">åœ¨ Debian/Ubuntu ä¸Š:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# service nagios3 restart 
</pre>

<h4 id="åœ¨-rhelcentos-6-ä¸Š">åœ¨ RHEL/CentOS 6 ä¸Š:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# service nagios restart 
</pre>

<h4 id="åœ¨-rhelcentos-7-ä¸Š">åœ¨ RHEL/CentOS 7 ä¸Š:</h4>

<pre class="prettyprint linenums prettyprinted" style="">
1.  \# systemctl restart nagios.service 
</pre>

<h3 id="æ•…éšœæ’é™¤">æ•…éšœæ’é™¤</h3>

<p>Nagiosåº”è¯¥å¼€å§‹åœ¨ä½¿ç”¨NRPEçš„è¿œç¨‹æœåŠ¡å™¨ä¸Šæ£€æŸ¥å†…å­˜ä½¿ç”¨ç‡äº†ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œä½ å¯ä»¥æ£€æŸ¥ä¸‹é¢è¿™äº›æƒ…å†µã€‚</p>

<ul>
  <li>ç¡®ä¿NRPEçš„ç«¯å£åœ¨è¿œç¨‹ä¸»æœºä¸Šæ˜¯æ€»æ˜¯å…è®¸çš„ã€‚é»˜è®¤NRPEçš„ç«¯å£æ˜¯TCP 5666ã€‚</li>
  <li>ä½ å¯ä»¥å°è¯•é€šè¿‡æ‰§è¡Œcheck_nrpe å‘½ä»¤ï¼š /usr/lib/nagios/plugins/check_nrpe -H remote-server æ‰‹å·¥æ£€æŸ¥NRPEæ“ä½œã€‚</li>
  <li>ä½ åŒæ ·å¯ä»¥å°è¯•è¿è¡Œcheck_mem å‘½ä»¤ï¼š/usr/lib/nagios/plugins/check_nrpe -H remote-server â€“c check_mem</li>
  <li>åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œåœ¨/etc/nagios/nrpe.cfgä¸­è®¾ç½®debug=1ã€‚é‡å¯NRPEæœåŠ¡å¹¶æ£€æŸ¥è¿™äº›æ—¥å¿—æ–‡ä»¶ï¼Œ/var/log/messages (RHEL/CentOS)æˆ–è€…/var/log/syslog (Debain/Ubuntu)ã€‚å¦‚æœæœ‰ä»»ä½•çš„é…ç½®æˆ–è€…æƒé™é”™è¯¯ï¼Œæ—¥å¿—ä¸­åº”è¯¥åŒ…å«äº†ç›¸å…³çš„ä¿¡æ¯ã€‚å¦‚æœæ—¥å¿—ä¸­æ²¡æœ‰åæ˜ å‡ºä»€ä¹ˆï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ç”±äºè¯·æ±‚åœ¨æŸäº›ç«¯å£ä¸Šæœ‰è¿‡æ»¤è€Œæ²¡æœ‰åˆ°è¾¾è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚</li>
</ul>

<p>æ€»ç»“ä¸€ä¸‹ï¼Œè¿™è¾¹æ•™ç¨‹æè¿°äº†æˆ‘ä»¬è¯¥å¦‚ä½•è°ƒè¯•NRPEæ¥ç›‘æ§è¿œç¨‹æœåŠ¡å™¨çš„å†…å­˜ä½¿ç”¨ç‡ã€‚è¿‡ç¨‹åªéœ€è¦ä¸‹è½½è„šæœ¬ã€å®šä¹‰å‘½ä»¤å’Œé‡å¯æœåŠ¡å°±è¡Œäº†ã€‚å¸Œæœ›è¿™å¯¹ä½ ä»¬æœ‰å¸®åŠ©ã€‚</p>
:ET