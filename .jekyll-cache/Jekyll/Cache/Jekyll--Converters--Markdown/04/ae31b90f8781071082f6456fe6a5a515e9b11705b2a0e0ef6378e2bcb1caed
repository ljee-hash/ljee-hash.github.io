I"²Q<h2 id="å‰è¨€">å‰è¨€</h2>

<p>å¾ˆä¹…æ²¡æœ‰å†™å…³äº Spring çš„æ–‡ç« äº†ï¼Œæœ€è¿‘åœ¨ç³»ç»Ÿæ¢³ç† Dubbo ä»£ç çš„è¿‡ç¨‹ä¸­å‘ç°äº† XML schema è¿™ä¸ªè¢«é—æ¼çš„çŸ¥è¯†ç‚¹ã€‚ç”±äºå·¥ä½œä¸­ä½¿ç”¨ SpringBoot æ¯”è¾ƒå¤šçš„åŸå› ï¼Œå‡ ä¹å¾ˆå°‘æ¥è§¦ XMLï¼Œæ­¤æ–‡å¯ä»¥ç®—åšæ˜¯äº¡ç¾Šè¡¥ç‰¢ï¼Œå¦ä¸€æ–¹é¢ï¼Œä¹Ÿä¸ºåç»­çš„ Dubbo æºç è§£æåšä¸ªé“ºå«ã€‚ã€‚</p>

<p>XML schema æ‰©å±•æœºåˆ¶æ˜¯å•¥ï¼Ÿè¿™å¹¶ä¸æ˜¯ä¸€å—å¾ˆå¤§çš„çŸ¥è¯†ç‚¹ï¼Œç¿»é˜…ä¸€ä¸‹ Spring çš„æ–‡æ¡£ï¼Œæˆ‘ç”šè‡³æ²¡æ‰¾åˆ°ä¸€ä¸ªè´¯ç©¿ä¸Šä¸‹æ–‡çš„è¯æ¥æè¿°è¿™ä¸ªåŠŸèƒ½ï¼ŒXML Schema Authoring æ˜¯æ–‡æ¡£ä¸­å¯¹åº”çš„æ ‡é¢˜ï¼Œç®€å•æ¥è¯´ï¼š</p>

<blockquote>
  <p>Spring ä¸ºåŸºäº XML æ„å»ºçš„åº”ç”¨æä¾›äº†ä¸€ç§æ‰©å±•æœºåˆ¶ï¼Œç”¨äºå®šä¹‰å’Œé…ç½® Beanã€‚ å®ƒå…è®¸ä½¿ç”¨è€…ç¼–å†™è‡ªå®šä¹‰çš„ XML bean è§£æå™¨ï¼Œå¹¶å°†è§£æå™¨æœ¬èº«ä»¥åŠæœ€ç»ˆå®šä¹‰çš„ Bean é›†æˆåˆ° Spring IOC å®¹å™¨ä¸­ã€‚</p>
</blockquote>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;beans</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:dubbo=</span><span class="s">"http://code.alibabatech.com/schema/dubbo"</span>
       <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
    http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd
    "</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- current application configuration --&gt;</span>
    <span class="nt">&lt;dubbo:application</span> <span class="na">name=</span><span class="s">"demo-provider"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- registry center configuration --&gt;</span>
    <span class="nt">&lt;dubbo:registry</span> <span class="na">address=</span><span class="s">"N/A"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- service configuration --&gt;</span>
    <span class="nt">&lt;dubbo:service</span> <span class="na">id=</span><span class="s">"service"</span> <span class="na">interface=</span><span class="s">"com.alibaba.dubbo.config.spring.api.DemoServiceSon"</span> <span class="na">ref=</span><span class="s">"demoService"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"demoService"</span> <span class="na">class=</span><span class="s">"com.alibaba.dubbo.config.spring.impl.DemoServiceSonImpl"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>

</code></pre></div></div>

<p>Dubbo ä¾èµ–äº† Springï¼Œå¹¶æä¾›äº†ä¸€å¥—è‡ªå®šä¹‰çš„ XML æ ‡ç­¾ï¼Œ<dubbo:application> ,<dubbo:registry> ,<dubbo:protocol>,<dubbo:service>ã€‚ä½œä¸ºä½¿ç”¨è€…ï¼Œå¤§å¤šæ•°äººåªéœ€è¦å…³å¿ƒè¿™äº›å‚æ•°å¦‚ä½•é…ç½®ï¼Œä½†ä¸çŸ¥é“æœ‰æ²¡æœ‰äººå¥½å¥‡è¿‡ï¼Œå®ƒä»¬æ˜¯å¦‚ä½•åŠ è½½è¿›å…¥ Spring çš„ IOC å®¹å™¨ä¸­è¢«å…¶ä»–ç»„ä»¶ä½¿ç”¨çš„å‘¢ï¼Ÿè¿™ä¾¿ç‰µæ‰¯å‡ºäº†ä»Šå¤©çš„ä¸»é¢˜ï¼šSpring å¯¹ XML schema çš„æ‰©å±•æ”¯æŒã€‚</dubbo:service></dubbo:protocol></dubbo:registry></dubbo:application></p>

<h2 id="è‡ªå®šä¹‰-xml-æ‰©å±•">è‡ªå®šä¹‰ XML æ‰©å±•</h2>

<p><strong>å®ŒæˆXMLè‡ªå®šä¹‰æ‰©å±•ï¼Œéœ€è¦ä¸‹é¢å‡ ä¸ªæ­¥éª¤:</strong></p>

<p><img src="https://upload-images.jianshu.io/upload_images/1329440-740c239f41566b16.png" alt="XMLè‡ªå®šä¹‰æ‰©å±•æ­¥éª¤" /></p>

<ol>
  <li>
    <p>åˆ›å»ºä¸€ä¸ª XML Schema æ–‡ä»¶ï¼Œæè¿°è‡ªå®šä¹‰çš„åˆæ³•æ„å»ºæ¨¡å—ï¼Œä¹Ÿå°±æ˜¯xsdæ–‡ä»¶</p>
  </li>
  <li>
    <p>è‡ªå®šä¹‰ä¸ªå¤„ç†å™¨ç±»ï¼Œå¹¶å®ç°NamespaceHandleræ¥å£(æ¯”è¾ƒå®¹æ˜“)</p>
  </li>
  <li>
    <p>è‡ªå®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªè§£æå™¨ï¼Œå®ç°BeanDefinitionParseræ¥å£(æœ€å…³é”®çš„éƒ¨åˆ†)</p>
  </li>
  <li>
    <p>æ³¨å†Œä¸Šé¢çš„ç»„ä»¶åˆ°Spring IOCå®¹å™¨ä¸­</p>
  </li>
</ol>

<p>æˆ‘ä»¬çš„ç›®çš„ä¾¿æ˜¯æƒ³è¦å®ç°ä¸€ä¸ª myns XML schemaï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸­å¯ä»¥è‡ªå®šä¹‰ demo.xmlï¼Œåœ¨å…¶ä¸­ä¼šä»¥ myns ä¸ºæ ‡ç­¾æ¥å®šä¹‰ä¸åŒçš„ç±»ï¼Œå¹¶åœ¨æœ€ç»ˆçš„æµ‹è¯•ä»£ç ä¸­éªŒè¯è¿™äº›å£°æ˜åœ¨ demo.xml çš„ç±»æ˜¯å¦è¢« Spring æˆåŠŸåŠ è½½ã€‚å¤§æ¦‚åƒè¿™æ ·ï¼Œæ˜¯ä¸æ˜¯å’Œ dubbo.xml çš„æ ¼å¼å¾ˆåƒå‘¢ï¼Ÿ</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:myns=</span><span class="s">"http://code.xxx.com/schema/myns"</span>
       <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd
    http://code.xxx.com/schema/myns http://code.xxx.com/schema/myns.xsd
    "</span><span class="nt">&gt;</span>

<span class="nt">&lt;myns:dateformat</span> <span class="na">id=</span><span class="s">"testDateFormat"</span>
                 <span class="na">pattern=</span><span class="s">"yyyy-MM-dd HH:mm"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div></div>

<h2 id="åŠ¨æ‰‹å®ç°">åŠ¨æ‰‹å®ç°</h2>

<p>æœ‰äº†æ˜ç¡®çš„ç›®æ ‡ï¼Œæˆ‘ä»¬é€æ­¥å¼€å±•è‡ªå·±çš„å·¥ä½œã€‚</p>

<h2 id="ç¼–å†™myxsd">ç¼–å†™my.xsd</h2>

<p>resources/META-INF/my.xsd</p>

<pre><code class="language-xsd">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsd:schema xmlns="http://code.xxx.com/schema/myns"
            xmlns:xsd="http://www.w3.org/2001/XMLSchema"
            xmlns:beans="http://www.springframework.org/schema/beans"
            targetNamespace="http://code.xxx.com/schema/myns"
            elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
    &lt;xsd:import namespace="http://www.springframework.org/schema/beans"/&gt;
    &lt;!--
        ç”¨æ³•:
        &lt;myns:dateformat id="dateFormat" pattern="yyyy-MM-dd HH:mm" /&gt;
        æˆ–
        &lt;bean id="dateFormat" class="java.text.SimpleDateFormat"&gt;
            &lt;constructor-arg value="yyyy-HH-dd HH:mm"/&gt;
        &lt;/bean&gt;
    --&gt;
    &lt;xsd:element name="dateformat"&gt;
        &lt;xsd:complexType&gt;
            &lt;xsd:complexContent&gt;
                &lt;xsd:extension base="beans:identifiedType"&gt;
                    &lt;xsd:attribute name="pattern" type="xsd:string" use="required"/&gt;
                &lt;/xsd:extension&gt;
            &lt;/xsd:complexContent&gt;
        &lt;/xsd:complexType&gt;
    &lt;/xsd:element&gt;

&lt;/xsd:schema&gt;
</code></pre>
<p>â‘  æ³¨æ„è¿™é‡Œçš„ targetNamespace=â€http://code.xxx.com/schema/mynsâ€ è¿™ä¾¿æ˜¯ä¹‹å myns æ ‡ç­¾çš„å…³é”®ç‚¹ã€‚
â‘¡ my.xsd å®šä¹‰äº†å…ƒç´ ï¼š dateformatï¼Œå‡ºäºç®€å•è€ƒè™‘ï¼Œéƒ½åªæœ‰ä¸€ä¸ª pattern å­—æ®µã€‚</p>

<blockquote>
  <p>schema çš„æ„ä¹‰åœ¨äºå®ƒå¯ä»¥å’Œ eclipse/IDEA è¿™æ ·æ™ºèƒ½åŒ–çš„é›†æˆå¼€å‘ç¯å¢ƒå½¢æˆå¾ˆå¥½çš„æ­é…ï¼Œåœ¨ç¼–è¾‘ XML çš„è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å¯ä»¥è·å¾—å‘Šè­¦å’Œæç¤ºã€‚ å¦‚æœé…ç½®å¾—å½“ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨å®ŒæˆåŠŸèƒ½è®©ç”¨æˆ·åœ¨äº‹å…ˆå®šä¹‰å¥½çš„æšä¸¾ç±»å‹ä¸­è¿›è¡Œé€‰æ‹©ã€‚</p>
</blockquote>

<p>2 ç¼–å†™DateformatNamespaceHandler</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.xml.NamespaceHandlerSupport</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DateformatNamespaceHandler</span> <span class="kd">extends</span> <span class="nc">NamespaceHandlerSupport</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">registerBeanDefinitionParser</span><span class="o">(</span><span class="s">"dateformat"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">DeteformatDefinitionParser</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>å®Œæˆ schema ä¹‹åï¼Œè¿˜éœ€è¦ä¸€ä¸ª NamespaceHandler æ¥å¸®åŠ© Spring è§£æ XML ä¸­ä¸åŒå‘½åç©ºé—´çš„å„ç±»å…ƒç´ ã€‚</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;myns:dateformat</span> <span class="na">id=</span><span class="s">"testDateFormat"</span> <span class="na">pattern=</span><span class="s">"yyyy-MM-dd HH:mm"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>ä¸åŒçš„å‘½åç©ºé—´éœ€è¦ä¸åŒçš„ NamespaceHandler æ¥å¤„ç†ï¼Œåœ¨ä»Šå¤©çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ DateformatNamespaceHandler æ¥è§£æ myns å‘½åç©ºé—´ã€‚DateformatNamespaceHandler ç»§æ‰¿è‡ª NamespaceHandlerSupport ç±»ï¼Œå¹¶åœ¨å…¶ init() æ–¹æ³•ä¸­æ³¨å†Œäº†ä¸¤ä¸ª BeanDefinitionParser ï¼Œç”¨äºè§£æ myns å‘½åç©ºé—´/myns.xsd çº¦æŸä¸­å®šä¹‰çš„å…ƒç´ ï¼šdateformatã€‚BeanDefinitionParser æ˜¯ä¸‹ä¸€æ­¥çš„ä¸»è§’ï¼Œæˆ‘ä»¬æš‚ä¸”è·³è¿‡ï¼Œå°†é‡å¿ƒæ”¾åœ¨çˆ¶ç±» NamespaceHandlerSupport ä¹‹ä¸Šã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">NamespaceHandler</span> <span class="o">{</span>
   <span class="kt">void</span> <span class="nf">init</span><span class="o">();</span>
   <span class="nc">BeanDefinition</span> <span class="nf">parse</span><span class="o">(</span><span class="nc">Element</span> <span class="n">element</span><span class="o">,</span> <span class="nc">ParserContext</span> <span class="n">parserContext</span><span class="o">);</span>
   <span class="nc">BeanDefinitionHolder</span> <span class="nf">decorate</span><span class="o">(</span><span class="nc">Node</span> <span class="n">source</span><span class="o">,</span> <span class="nc">BeanDefinitionHolder</span> <span class="n">definition</span><span class="o">,</span> <span class="nc">ParserContext</span> <span class="n">parserContext</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>NamespaceHandlerSupport æ˜¯ NamespaceHandler å‘½åç©ºé—´å¤„ç†å™¨çš„æŠ½è±¡å®ç°ï¼Œæˆ‘ç²—ç•¥çœ‹äº†NamespaceHandler çš„å‡ ä¸ªå®ç°ç±»ï¼Œparse å’Œ decorate æ–¹æ³•å¯ä»¥å®Œæˆå…ƒç´ èŠ‚ç‚¹çš„ç»„è£…å¹¶é€šè¿‡ ParserContext æ³¨å†Œåˆ° Ioc å®¹å™¨ä¸­ï¼Œä½†å®é™…æˆ‘ä»¬å¹¶æ²¡æœ‰è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯é€šè¿‡ init() æ–¹æ³•æ³¨å†Œ BeanDefinitionParser æ¥å®Œæˆè§£æèŠ‚ç‚¹ä»¥åŠæ³¨å†Œ Bean çš„å·¥ä½œï¼Œæ‰€ä»¥å¯¹äº NamespaceHandlerï¼Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒ init ä¸­æ³¨å†Œçš„ä¸¤ä¸ª BeanDefinitionParser å³å¯ã€‚</p>

<p>3 ç¼–å†™DeteformatDefinitionParser
åœ¨æ–‡ç« å¼€å§‹æˆ‘ä»¬ä¾¿æ ‡è®°åˆ° BeanDefinitionParser æ˜¯æœ€ä¸ºå…³é”®çš„ä¸€ç¯ï¼Œæ¯ä¸€ä¸ª BeanDefinitionParser å®ç°ç±»éƒ½è´Ÿè´£ä¸€ä¸ªæ˜ å°„ï¼Œå°†ä¸€ä¸ª XML èŠ‚ç‚¹è§£ææˆ IOC å®¹å™¨ä¸­çš„ä¸€ä¸ªå®ä½“ç±»ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.xml.AbstractSingleBeanDefinitionParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.support.BeanDefinitionBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.Element</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>

<span class="cm">/**
 * è§£æå®šä¹‰çš„æ ‡ç­¾
 * &lt;myns:dateformat id="dateFormat" pattern="yyyy-MM-dd HH:mm" /&gt;
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DeteformatDefinitionParser</span> <span class="kd">extends</span> <span class="nc">AbstractSingleBeanDefinitionParser</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getBeanClass</span><span class="o">(</span><span class="nc">Element</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">SimpleDateFormat</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doParse</span><span class="o">(</span><span class="nc">Element</span> <span class="n">element</span><span class="o">,</span> <span class="nc">BeanDefinitionBuilder</span> <span class="n">beanDefinitionBuilder</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">//è§£æpatterné…ç½®é¡¹</span>
        <span class="nc">String</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"pattern"</span><span class="o">);</span>
        <span class="n">beanDefinitionBuilder</span><span class="o">.</span><span class="na">addConstructorArgValue</span><span class="o">(</span><span class="n">pattern</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>ç”±äºæˆ‘ä»¬çš„å®ä½“ç±»æ˜¯éå¸¸ç®€å•çš„ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å¾ˆå¤æ‚çš„è§£æä»£ç ï¼Œè€Œå®é™…é¡¹ç›®ä¸­ï¼Œå¾€å¾€éœ€è¦å¤§é‡çš„è§£ææ­¥éª¤ã€‚parse æ–¹æ³•ä¼šè§£æä¸€ä¸ªä¸ª XML ä¸­çš„å…ƒç´ ï¼Œä½¿ç”¨ RootBeanDefinition ç»„è£…æˆå¯¹è±¡ï¼Œå¹¶æœ€ç»ˆé€šè¿‡ parserContext æ³¨å†Œåˆ° IOC å®¹å™¨ä¸­ã€‚</p>

<p>è‡³æ­¤ï¼Œæˆ‘ä»¬ä¾¿å®Œæˆäº† XML æ–‡ä»¶ä¸­å®šä¹‰çš„å¯¹è±¡åˆ° IOC å®¹å™¨çš„æ˜ å°„ã€‚</p>

<h3 id="4-æ³¨å†Œschemaå’Œhandler">4 æ³¨å†Œschemaå’Œhandler</h3>

<p>æœ€åä¸€æ­¥è¿˜éœ€è¦é€šçŸ¥ Springï¼Œå‘ŠçŸ¥å…¶è‡ªå®šä¹‰ schema çš„æ‰€åœ¨ä¹‹å¤„ä»¥åŠå¯¹åº”çš„å¤„ç†å™¨ã€‚</p>

<p>resources/META-INF/spring.handlers</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http<span class="se">\:</span>//code.xxx.com/schema/myns<span class="o">=</span>com.xxx.app.server.spi.config.schema.DateformatNamespaceHandler
</code></pre></div></div>

<p>resources/META-INF/spring.schemas</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http<span class="se">\:</span>//code.xxx.com/schema/myns.xsd<span class="o">=</span>META-INF/my.xsd
</code></pre></div></div>

<p>æ²¡æœ‰å¤ªå¤šå¯ä»¥è¯´çš„ï¼Œéœ€è¦éµå®ˆ Spring çš„çº¦å®šã€‚</p>

<p>è‡³æ­¤ä¸€ä¸ªè‡ªå®šä¹‰çš„ XML schema ä¾¿æ‰©å±•å®Œæˆäº†ï¼Œéšåæ¥éªŒè¯ä¸€ä¸‹ã€‚</p>

<h2 id="éªŒè¯æ‰©å±•">éªŒè¯æ‰©å±•</h2>

<p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰å¥½ demo.xml</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:myns=</span><span class="s">"http://code.xxx.com/schema/myns"</span>
       <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd
    http://code.xxx.com/schema/myns http://code.xxx.com/schema/myns.xsd
    "</span><span class="nt">&gt;</span>

<span class="nt">&lt;myns:dateformat</span> <span class="na">id=</span><span class="s">"testDateFormat"</span>
                 <span class="na">pattern=</span><span class="s">"yyyy-MM-dd HH:mm"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div></div>
<p>ä½¿ç”¨ Spring å»åŠ è½½å®ƒï¼Œå¹¶éªŒè¯ IOC å®¹å™¨ä¸­æ˜¯å¦å­˜åœ¨æ³¨å†ŒæˆåŠŸçš„ Beanã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigTest</span> <span class="o">{</span>


    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSpringDateFormat</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ClassPathXmlApplicationContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="nc">ConfigTest</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="sc">'.'</span><span class="o">,</span> <span class="sc">'/'</span><span class="o">)</span> <span class="o">+</span> <span class="s">"/demo.xml"</span><span class="o">);</span>
        <span class="n">ctx</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">SimpleDateFormat</span> <span class="n">dateFormat</span> <span class="o">=</span> <span class="o">(</span><span class="nc">SimpleDateFormat</span><span class="o">)</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"testDateFormat"</span><span class="o">);</span>
            <span class="n">assertNotNull</span><span class="o">(</span><span class="n">dateFormat</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">date</span> <span class="o">=</span> <span class="s">"2010-10-10 11:12:14"</span><span class="o">;</span>
                <span class="nc">SimpleDateFormat</span> <span class="n">ymdhms</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">);</span>
                <span class="nc">Date</span> <span class="n">time</span> <span class="o">=</span> <span class="n">ymdhms</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">date</span><span class="o">);</span>
                <span class="nc">String</span> <span class="n">dateFormatStr</span> <span class="o">=</span> <span class="n">dateFormat</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">time</span><span class="o">);</span>
                <span class="n">assertTrue</span><span class="o">(</span><span class="s">"2010-10-10 11:12"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">dateFormatStr</span><span class="o">));</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ParseException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//æ‰§è¡Œè§£æå‘ç”Ÿå¼‚å¸¸</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">ctx</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
            <span class="n">ctx</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>


<span class="o">}</span>

</code></pre></div></div>

<p>è§‚å¯Ÿæ§åˆ¶å°çš„è¾“å‡ºï¼š</p>

<p>2010-10-10 11:12</p>

<p>ä¸€ä¸ªåŸºç¡€çš„åŸºäº XML schema çš„æ‰©å±•ä¾¿å®Œæˆäº†ã€‚</p>

<h3 id="dubboä¸­çš„xml-schemaæ‰©å±•">Dubboä¸­çš„XML schemaæ‰©å±•</h3>

<p>æœ€åæˆ‘ä»¬ä»¥ Dubbo ä¸ºä¾‹ï¼Œçœ‹çœ‹ä¸€ä¸ªæˆç†Ÿçš„ XML schema æ‰©å±•æ˜¯å¦‚ä½•è¢«åº”ç”¨çš„ã€‚</p>

<p><img src="http://kirito.iocoder.cn/image-20180903190429383.png" alt="Dubboä¸­çš„åº”ç”¨" /></p>

<p>åˆšå¥½å¯¹åº”äº†å››ä¸ªæ ‡å‡†çš„æ‰©å±•æ­¥éª¤ï¼Œæ˜¯ä¸æ˜¯å¯¹ XML é…ç½®ä¸‹çš„ Dubbo åº”ç”¨æœ‰äº†æ›´å¥½çš„ç†è§£äº†å‘¢ï¼Ÿ</p>

<p>é¡ºå¸¦ä¸€æï¼Œä»…ä»…å®Œæˆ Bean çš„æ³¨å†Œè¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œåœ¨â€œæ³¨å†Œâ€çš„åŒæ—¶ï¼ŒDubbo è¿˜è¿›è¡Œäº†ä¸€ç³»åˆ—å…¶ä»–æ“ä½œå¦‚ï¼šæš´éœ²ç«¯å£ï¼Œå¼€å¯æœåŠ¡å™¨ï¼Œå®Œæˆæ³¨å†Œä¸­å¿ƒçš„æ³¨å†Œï¼Œç”Ÿæˆä»£ç†å¯¹è±¡ç­‰ç­‰è¡Œä¸ºï¼Œç”±äºä¸åœ¨æœ¬æ–‡çš„èŒƒå›´å†…ï¼Œåç»­çš„ Dubbo ä¸“é¢˜ä¼šä¸“é—¨ä»‹ç»è¿™äº›ç»†èŠ‚ï¼Œæœ¬æ–‡ä¾¿æ˜¯äº†è§£ Dubbo åŠ è½½æµç¨‹çš„å‰ç½®æ–‡ç« äº†ã€‚</p>

:ET